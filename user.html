<!DOCTYPE html>
<html>
<head>
	<title>Users Admin Panel</title>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.2/css/bulma.min.css">
</head>
<body>
	<div class="container">
		<section class="section">
			<h1 class="title">Users Admin Panel</h1>
			<hr>
			<h2 class="subtitle">Create User</h2>
			<form id="create-user-form">
        <div class="field">
          <label class="label">Prenom</label>
          <div class="control">
            <input class="input" type="text" placeholder="Enter prenom" name="prenom">
          </div>
        </div>
        <div class="field">
          <label class="label">Nom</label>
          <div class="control">
            <input class="input" type="text" placeholder="Enter nom" name="nom">
          </div>
        </div>
        <div class="field">
          <label class="label">Login</label>
          <div class="control">
            <input class="input" type="text" placeholder="Enter login" name="login">
          </div>
        </div>
        <div class="field">
          <label class="label">Password</label>
          <div class="control">
            <input class="input" type="password" placeholder="Enter password" name="password">
          </div>
        </div>
        <div class="field">
          <label class="label">Groupe</label>
          <div class="control">
            <input class="input" type="text" placeholder="Enter groupe" name="groupe">
          </div>
        </div>
        <div class="field">
          <div class="control">
            <button class="button is-primary" type="button" onclick="createUser()">Create User</button>
          </div>
        </div>
      </form>
      
      <script>
      function createUser() {
        // Get form data
        const formData = {
          prenom: document.querySelector('input[name="prenom"]').value,
          nom: document.querySelector('input[name="nom"]').value,
          login: document.querySelector('input[name="login"]').value,
          password: document.querySelector('input[name="password"]').value,
          groupe: document.querySelector('input[name="groupe"]').value,
        };
      
        // Make POST request to Flask endpoint
        fetch('/users', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => console.log(data))
        .catch(error => console.error(error));
      }
      </script>
      
        </section>
        <section class="section">
          <h2 class="subtitle">All Users</h2>

            <table id="users-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Login</th>
                    <th>Password</th>
                    <th>Group</th>
                  </tr>
                </thead>
                <tbody id="users-table-body">
                </tbody>
              </table>
        </section>
    </div>
    <script>
        function getUsers() {
  fetch('/users', {
		method: 'GET',
		headers: {
			'Content-Type': 'application/json'
		}})
    .then(function(response) {
      return response.json();
    })
    .then(function(data) {
      let tableBody = document.getElementById('users-table-body');
      let tableHtml = '';
      data.forEach(function(user) {
        tableHtml += `<tr>
                        <td>${user.id}</td>
                        <td>${user.prenom}</td>
                        <td>${user.nom}</td>
                        <td>${user.login}</td>
                        <td>${user.password}</td>
                        <td>${user.groupe}</td>
                        <td>
                          <button class="button is-danger" onclick="deleteUser(${user.id})">Delete User</button>
                        </td>
                      </tr>`;
      });
      tableBody.innerHTML = tableHtml;
      // Add Bulma classes to table
      let table = document.getElementById('users-table');
      table.classList.add('table', 'is-bordered', 'is-striped', 'is-hoverable', 'is-fullwidth');
    })
    .catch(function(error) {
      console.log(error);
    });
}
 getUsers();



    function deleteUser(id) {
        fetch('/users/' + id, {
            method: 'DELETE',
        })
        .then(response => response.json())
        .then(data => console.log(data))
        .catch(error => console.log(error));
    }


    </script>

    <section class="section">
      <form id="update-user-form">
        <label class="label">id</label>
        <input class="input" type="text" name="id" value="1">
        <div class="field">
            <label class="label">Prenom</label>
            <div class="control">
                <input class="input" type="text" placeholder="Enter prenom" name="prenom">
            </div>
        </div>
        <div class="field">
            <label class="label">Nom</label>
            <div class="control">
                <input class="input" type="text" placeholder="Enter nom" name="nom">
            </div>
        </div>
        <div class="field">
            <label class="label">Login</label>
            <div class="control">
                <input class="input" type="text" placeholder="Enter login" name="login">
            </div>
        </div>
        <div class="field">
            <label class="label">Password</label>
            <div class="control">
                <input class="input" type="password" placeholder="Enter password" name="password">
            </div>
        </div>
        <div class="field">
            <label class="label">Groupe</label>
            <div class="control">
                <input class="input" type="text" placeholder="Enter groupe" name="groupe">
            </div>
        </div>
        <div class="field">
            <div class="control">
                <button class="button is-primary">Update User</button>
            </div>
        </div>
    </form>
    
    <script>
        const form = document.getElementById('update-user-form');
    
        form.addEventListener('submit', (event) => {
            event.preventDefault();
    
            const formData = new FormData(form);
    
            fetch('/users/' + formData.get('id'), {
                method: 'PUT',
                body: JSON.stringify(Object.fromEntries(formData)),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.log(error));
        });
    </script>
    

    </section>
    </body>
</html>